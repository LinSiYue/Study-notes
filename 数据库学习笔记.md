# 数据库学习笔记

## 一、简介（主要以MySQL为例）

SQL可分为：数据操作语言（DML）和数据定义语言（DDL）。

> DML包括：对表字段查询、更新、插入和删除。
>
> * SELECT
> * UPDATE
> * DELETE
> * INSERT INTO

> DDL包括：对表的操作，创建、修改或删除表。
>
> * CREATE DATABASE
> * ALTER DATABASE
> * CREATE TABLE
> * ALTER TABLE
> * DROP TABLE
> * CREATE INDEX
> * DROP INDEX

## 二、DDL语句

### 1、表的创建

代码示例：

```mysql
create table t_students(
sno Char(8) not null,
sname varchar(32) not null,
sex char(2) not NULL,
sb Date not null,
dep varchar(32) not null,
hobby varchar(32),
check(sex in('男','女')),#不起作用
primary key(sno)
);

create table t_courses(
cno char(2) not NULL,
cname varchar(32) not null,
precno char(2),
primary key(cno)
);

create table t_grade(
sno char(8) not NULL,
cno char(2) not null,
grade dec(4,1),
foreign key(sno) REFERENCES t_students(sno),
foreign key(cno) REFERENCES t_courses(cno),
check(grade between 0.0 and 100.0)#不起作用
);
```

### 2、表删除

代码示例：

```mysql
drop table t_students;
```

### 3、表修改

代码示例：

```mysql
#为表添加字段
alter table t_students add id_card2 char(18) not null;
#修改表字段属性
alter table t_students modify sname varchar(30) not null;
#删除表字段
alter table t_students drop id_card2;
```

## 三、DML语句

### 1、查询

代码示例：

```mysql
#1）.查询每个学生各科成绩。
select * from t_students LEFT JOIN t_grade on t_students.sno = t_grade.sno;
#2）.查询年龄大于21岁的学生（根据身份证，将生日因素也参加计算）
#注解：身份证号码第7位（从1开始计算）开始后8位为出生年月日；
#substring(字段,starIndex,length)方法截取字段从starIndex开始截取8位字符。
#再用str_to_date将字符串类型转换为日期类型，最后用timestampdiff()方法计算年龄
select * from t_students where TIMESTAMPDIFF(year,str_to_date(SUBSTRING(id_card,7,8),'%Y%m%d'),curdate())>21;
#3）.查询成绩比该课程平均成绩低的同学的成绩表(不包括成绩为null的)
#注解:在使用group by的时候会报错，需要修改sql.model，去掉“ONLY_FULL_GROUP_BY”
#select @@global.sql_mode;
#set #@@global.sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_B#Y_ZERO,NO_ENGINE_SUBSTITUTION'
select sno,t_grade.cno,grade,avg_grade from t_grade,(select cno,avg(grade) as avg_grade from t_grade group by cno) as c_avg where t_grade.cno = c_avg.cno and t_grade.grade < c_avg.avg_grade;
#4）.查询成绩比该课程平均成绩低的同学的成绩表(包括成绩为null的)
select sno,t_grade.cno,grade,avg_grade,s.num from t_grade,(select cno,sum(grade)/count(cno) as avg_grade,count(cno) as num from t_grade group by cno) as s 
  where t_grade.cno = s.cno and t_grade.grade>s.avg_grade;
```

### 2、插入

代码示例：

```mysql
insert into t_students values('06131301','钟耀辉','男','1997-06-25','计算机','运动'),
                             ('06131302','李华','男','1997-07-29','计算机', '游戏'),
                             ('03131201','邓佳','男','1998-09-15','机械', null),
                             ('03131301','林倩','女','1998-02-25','机械','唱歌'),
                             ('04131301','胡文','男','1997-06-25','工商','看电影'),
                             ('04131302','李军','男','1997-08-12','工商',null),
                             ('05131301','白石','男','1998-10-25','电子','运动'),
                             ('05131302','王胜','女','1998-03-05','电子',null);
insert into t_grade(grade) value(92.5);
```

### 3、修改

代码示例：

```mysql
#将身份证号码为445122199706255625的学生的学号修改为06131301
update t_students set id_card='445122199706255625' where sno='06131301';
#将C1课程成绩低于平均分的学生的成绩增加2分
update t_grade set grade=grade+2 where grade in (select grade from t_grade where cno='C1' and grade<avg(grade));
```

### 4、删除

代码示例：

```mysql
#删除课程成绩为null的一行
delete from t_grade where grade is null;
#删除重复行，保留id最小的一个
delete from t_students_copy where id not in (select stc.sid from (select min(id) as sid from t_students_copy group by sname) stc);
```